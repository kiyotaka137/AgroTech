# AgroTech

1. Постановка задачи
* Цель: По PDF-файлу с таблицами по рациону коров, химического анализа рациона и другими, предсказать процент различных кислот из списка в конечном продукте.
* Тип задачи: Регрессия с рекомендательной системой


2. Наш подход 
* Разбор данных и формулировка целевой метрики. Провели разведку датасета, выделили целевую переменную. Задача регрессии, значит будет использовать для обучения MSELoss, а метрику RMSE, чтобы величины были такого же порядка и R^2 - чтобы понимать обобщающую способность модели
* Парсинг. Спарсили pdf-файл в pandas.DataFrame для дальнейшей работы, использовали 2 таблицы - рацион и хим анализ, так как они есть во всех отчетах
* Фиче-инжиниринг:
    * Сделали кастомный OHE для категориальных признаков
    * Сделали обработку None
    * Выкинули неифнормативные признаки
* Базовая модель: Для начала выбрали Ridge для baseline и смотрели на RMSE и R^2 на LOOCV
* Валидация: LOOCV - так как данный мало, порядка 100, а данный способ дает лучшие результаты
* Выбор моделей:  выбор пал на ансамбль из CatBoost, RandomForst, Ridge, SVR  + нормализация данных и подбор гиперпараметров на GridSearchCV
* Обработка названий рациона: регулярные выражения + mini-llm
* Интерпретируемость: SHAP
* Результат: Из-за того что данных мало, то на тестовую выборку осталось 10 сэмплов, что не дает стабильные метрики для обучения (поэтому не привожу результатов)


3. Технические детали
* ML Использовали библиотеку scikit-learn для обучения модели, валидации и тп и SHAP для интерпретации
* Десктоп Использовали библиотек PyQt6 для создания десктоп приложения


4. Проблемы, с которыми столкнулись
* Очень малое количество данных, на которых более информативные модели нельзя обучить
* Ужасное качество и формат данных, которые по позволяют унифицировать в полной мере работу с ними


5. Что сработало лучше всего
* Модель Использовали ансамбль из CatBoost, RandomForest, Ridge, SVR + нормализация данных
* Ансамбль Для того чтобы в ансамбле модели были с каким-то весов, чтобы уравновешивать их, использовали 1/RMSE + normalization, RMSE брали усредненный по 10 запускам на LOOCV
* Гиперпараметры Подбирались с помощью GridSearchCV с кросс-валидацией (k‎ = 5) для всего ансамбля, сначала широкий поиск, далее более узкий
* Рекомендации Использовали SHAP для того, чтобы интерпретировать вклад признаков. Сделали SHAP для вклада признаков в предсказание кислоты, и вклада рациона в его химический анализ.


6. Интерпретация результатов
* Дана таблица с предсказанными значениями кислот
* В итоговом отчете есть графики SHAP, показывающие вклад каждого признака, то есть например если признак 1 дает увеличение сильное целевой переменной, то при уменьшении его, целевая переменная тоже уменьшиться, но стоит учитывать то, что из-за нелинейности ансамбля нет линейного уменьшения.
* Для удобства для кислот, а также для нутриентов приведены таблицы с топ самых влияющих признаков


7. Что можно улучшить
* При добавлении более качественных данных и большего по количеству обучить
* Более точный подбор гиперпараметров

